<!-- static/overlay.html -->
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Draft Overlay</title>
<style>
  html,body{height:100%;margin:0;background:transparent;overflow:hidden}
  body{font-family:Inter,Arial,Helvetica;background:transparent}
  .stage{position:relative;width:1920px;height:1080px;background:url('/assets/template.png') center/cover no-repeat}
  .left{position:absolute; left:48px; top:120px; width:360px; color:#fff}
  .right{position:absolute; right:48px; top:120px; width:360px; color:#fff; text-align:right}
  .team-name{font-weight:800;font-size:22px}
  .players{font-size:13px;color:#cbd5e1;margin-top:6px}
  .label{font-size:12px;color:#9fb0c8;margin-top:8px}
  .row{display:flex;gap:10px;margin-top:8px;justify-content:flex-start}
  .row.right{justify-content:flex-end}
  .slot{width:86px;height:86px;border-radius:12px;overflow:hidden;background:rgba(0,0,0,0.12);display:flex;align-items:center;justify-content:center;transition:transform .28s,box-shadow .28s}
  .slot img{width:100%;height:100%;object-fit:cover}
  .slot.new{transform:scale(1.12);box-shadow:0 18px 30px rgba(0,0,0,0.45)}
  .meta{position:absolute;left:50%;transform:translateX(-50%);top:72px;text-align:center}
  .mode{font-size:20px;font-weight:700;background:#fff;padding:6px 18px;border-radius:8px}
</style>
</head>
<body>
  <div class="stage" id="stage">
    <div class="left">
      <div class="team-name" id="teamAName">Team A</div>
      <div class="players" id="teamAPlayers">Player1 • Player2 • Player3</div>
      <div class="label">Bans</div>
      <div class="row" id="teamABans"></div>
      <div class="label">Picks</div>
      <div class="row" id="teamAPicks"></div>
    </div>
    <div class="right">
      <div class="team-name" id="teamBName">Team B</div>
      <div class="players" id="teamBPlayers">Player1 • Player2 • Player3</div>
      <div class="label">Bans</div>
      <div class="row right" id="teamBBans"></div>
      <div class="label">Picks</div>
      <div class="row right" id="teamBPicks"></div>
    </div>

    <div class="meta">
      <div class="mode" id="mode">GEM GRAB</div>
      <div id="map" style="margin-top:6px;font-size:14px;color:#08364e"></div>
    </div>
  </div>

<script>
const DRAFT_URL = "/draft";
function slugify(name){
  if(!name) return "";
  return String(name).toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9\-]/g,"");
}
function iconUrl(name){
  if(!name) return "/assets/placeholder.png";
  const slug = slugify(name);
  return `https://cdn.brawlify.com/brawler/${slug}.png`;
}
function renderSlots(containerId, items, newItems){
  const cont = document.getElementById(containerId);
  cont.innerHTML = "";
  (items||[]).forEach(x=>{
    const slot = document.createElement("div"); slot.className="slot";
    const img = document.createElement("img"); img.src = iconUrl(x); img.alt = x; img.title = x;
    slot.appendChild(img);
    if(newItems && newItems.includes(x)){
      slot.classList.add("new");
      setTimeout(()=> slot.classList.remove("new"), 1200);
    }
    cont.appendChild(slot);
  });
  const maxSlots = containerId.toLowerCase().includes("picks") ? 3 : 2;
  for(let i=(items||[]).length;i<maxSlots;i++){
    const s=document.createElement("div"); s.className="slot"; s.style.opacity="0.2"; cont.appendChild(s);
  }
}
async function update(){
  try{
    const res = await fetch(DRAFT_URL);
    const data = await res.json();
    document.getElementById("teamAName").innerText = data.teamA.name || "Team A";
    document.getElementById("teamBName").innerText = data.teamB.name || "Team B";
    document.getElementById("teamAPlayers").innerText = (data.teamA.players||[]).join(" • ");
    document.getElementById("teamBPlayers").innerText = (data.teamB.players||[]).join(" • ");
    document.getElementById("mode").innerText = data.mode || "";
    document.getElementById("map").innerText = data.map || "";
    const diff = data._diff || {"teamA":{"new_picks":[],"new_bans":[]},"teamB":{"new_picks":[],"new_bans":[]}};
    renderSlots("teamAPicks", data.teamA.picks||[], diff.teamA.new_picks||[]);
    renderSlots("teamBPicks", data.teamB.picks||[], diff.teamB.new_picks||[]);
    renderSlots("teamABans", data.teamA.bans||[], diff.teamA.new_bans||[]);
    renderSlots("teamBBans", data.teamB.bans||[], diff.teamB.new_bans||[]);
  }catch(e){
    // silent
  }
}
update();
setInterval(update, 1000);
</script>
</body>
</html>
